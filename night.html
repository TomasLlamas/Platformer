<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="logo.png">
    <title>What Strikes at Night</title>
    <style>
      body{
        background-color: #000000;
      }
      canvas {
        background-color: #f1f1f1;
        padding: 0;
        margin: auto;
        display: block;
        width: 1000px;
        height: 500px;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        cursor: crosshair;
      }
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0px;
        border: 0;
        overflow: hidden;
        display: block;
      }
      .title-style {
        width: 100%;
        height: 100%;
        padding: 50px;
        background-color: black;
        font-size: 25px;
        color: white;
        font-family: Helvetica, sans-serif;
      }
      button {
        background-color: white;
        width: 300px;
        height: 100px;
        margin: 20px;
        font-size: 25px;
        border: none;
        cursor: pointer;

      }
      button:hover {
        background-color: orange;
      }
      #side {
        height: 470px;
        border-width: 1px;
        border-top:5px solid green;
        border-bottom:5px solid green;
        padding: 10px;
        font-family: Helvetica; 
        color: white;
      }
    </style>
  </head>
  <body>
<div id="title" class="title-style">What Strikes at Night<br /><br \>A game by Kyle Macasilli-Tan
  <br />
  <button onclick="toggleScreen()">Start</button>
  <br />
  <button onclick="">How to Play</button>
  <br />
  <button onclick="">About</button>
</div>
    


    <script>
function toggleScreen() {
  var title = document.getElementById("title");
  if (title.style.display === "none") {
    title.style.display = "block";
  } else {
    title.style.display = "none";
  }
  startGame();
}

      var player;
      var hp = "3";
      var money = 0;
      var bullets = [];
      var enemy = [];
      var mapArray = [];
      var trees = [];
      var stones = [];
      var stoneAmount = 0;
      var woodAmount = 0;
      var shoot = false;
      var fuelColor = "green";
      var deathScreen;
      var deathText1;
      var deathText2;
      var deathText3;
      var enemyCounter;
      var passCounter;
      var kills = 0;
      var passes = 0;
      var deathTimer = 0;
      var typeDeath = "you lived";
      var movementSpeed = 2;
      var backgroundSound;
      var portalSound;
      var vaporize;
      var timer = 0;
      var scene = "survival";
      var l = "l";
      var k = "k";



      /*
      ground
      */

      var map = [
        2,2,2,2,2,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,
        2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
        2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
        2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
        2,0,0,0,2,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,4,1,0,0,0,0,0,0,0,
        0,0,0,0,0,2,4,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        3,3,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        3,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        3,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,2,2,4,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,2,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,3,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,3
    ];





      function startGame() {
        player = new component(10, 10, "black", 0, 475, "normal");
        vaporize = new sound("vaporize.mp3");
        deathScreen = new component(0,0,"red",0,0);
        deathText1 = new component("50px",  "Helvetica", "black",  500,  150,  "text");
        deathText2 = new component("50px",  "Helvetica", "black",  500,  250,  "text");
        deathText3 = new component("50px",  "Helvetica", "black",  500,  350,  "text");
        enemyCounter = new component("20px",  "Helvetica", "black",  1050,  20,  "text");
        passCounter = new component("20px",  "Helvetica", "black",  1050,  50,  "text");
        Game.keys = [];
        Game.start();
      }

      var Game = {
        canvas: document.createElement("canvas"),
        start: function() {
          this.canvas.width = 1000;
          this.canvas.height = 500;

          this.context = this.canvas.getContext("2d");
          document.body.insertBefore(this.canvas, document.body.childNodes[0]);
          this.frameNo = 0;
          this.interval = setInterval(updateGame, 20);
          window.addEventListener("mousemove", function(e) {
            Game.x = e.pageX;
            Game.y = e.pageY;
          });
          window.addEventListener("keydown", function(e) {
            Game.keys = Game.keys || [];
            Game.keys[e.keyCode] = true;
          });
          window.addEventListener("keyup", function(e) {
            Game.keys[e.keyCode] = false;
          });
          window.addEventListener("mousedown", function(e) {
            shoot = true;
          });
          window.addEventListener("mouseup", function(e) {
            shoot = false;
          });
        },
        clear: function() {
          this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },
        stop: function() {
          clearInterval(this.interval);
        }
      };

      function everyinterval(n) {
        if ((myGameArea.frameNo / n) % 1 == 0) {
          return true;
        }
        return false;
      }

      function component(width, height, color, x, y, type, xSpeed, ySpeed) {
        this.type = type;
        if (type == "image") {
          this.image = new Image();
          this.image.src = color;
        }
        this.width = width;
        this.height = height;
        this.x = x;
        this.y = y;
        this.xSpeed = xSpeed;
        this.ySpeed = ySpeed;
        this.color = color;
        this.text = "";
        this.update = function() {
          ctx = Game.context;
          if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
          } else if (type == "image") {
            ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
          } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
          }
        };
      }

      function sound(src) {
        this.sound = document.createElement("audio");
        this.sound.src = src;
        this.sound.setAttribute("preload", "auto");
        this.sound.setAttribute("controls", "none");
        this.sound.style.display = "none";
        document.body.appendChild(this.sound);
        this.play = function() {
          this.sound.play();
        };
        this.stop = function() {
          this.sound.pause();
        };
      }





      function updateBullets(b) {
        for (var i = 0; i < b.length; i += 1) {
            if (
            player.x < b[i].x + b[i].width &&
            player.x + player.width > b[i].x &&
            player.y < b[i].y + b[i].height &&
            player.y + player.height > b[i].y
          ) {
            if(Game.keys[87] && timer > 10){
                verticalPower = 5;
                b.splice(i,1);
                gravity = 0;
                

            }
          }

          for(e = 0; e < enemy.length; e += 1){
            if(
            enemy[e].x < b[i].x + b[i].width &&
            enemy[e].x + enemy[e].width > b[i].x &&
            enemy[e].y < b[i].y + b[i].height &&
            enemy[e].y + enemy[e].height > b[i].y
            ){
                enemy.splice(e,1);
                bullets.splice(b,1);
                kills+=1;
            }
          }



          if (b[i].x > 980 || b[i].x < 0 || b[i].y > 490 || b[i].y < 0) {
            b.splice(i, 1);
          } else {
            b[i].x = b[i].x + b[i].xSpeed;
            b[i].y = b[i].y + b[i].ySpeed;
          }
          for (m = 0; m < mapArray.length; m += 1) {  
          if (
            mapArray[m].x < b[i].x + b[i].width &&
            mapArray[m].x + mapArray[m].width > b[i].x &&
            mapArray[m].y < b[i].y + b[i].height &&
            mapArray[m].y + mapArray[m].height > b[i].y
          ) {
                if(mapArray[m].type =="key"){
                    for (a = 0; a < mapArray.length; a += 1) {
                        if(mapArray[a].type == "lock"){
                            map.splice(a, 1, 0);
                            b.splice(i,1);
                        }
                    }
                } else if(mapArray[m].type !="sky" && mapArray[m].type != "water" && mapArray[m].type !="exit"){
                b.splice(i, 1);
              }
          } 
        }
      }
    }

      function fireBullets() {
        var verticalBulletPower =
          (Game.y - (window.innerHeight - 500) / 2 - player.y - 5) / 50;
        var sideBulletPower =
          (Game.x - (window.innerWidth - 1200) / 2 - player.x - 5) / 50;
        timer += 1;
        if (shoot==true && timer > 20) {
          bullets.push(
            new component(
              10,
              10,
              "gray",
              player.x,
              player.y,
              "multiarray",
              sideBulletPower,
              verticalBulletPower
            )
          );
          timer = 0;
        }
      }

      function mapCollision(object) {
        
        for (i = 0; i < mapArray.length; i += 1) {  
          var horizontal =
                mapArray[i].x +
                (mapArray[i].width / 2) -
                (object.x + object.width / 2);
        var vertical =
                mapArray[i].y +
                (mapArray[i].height / 2) -
                (object.y + object.height / 2);
          if (
            mapArray[i].x < object.x + object.width &&
            mapArray[i].x + mapArray[i].width > object.x &&
            mapArray[i].y < object.y + object.height &&
            mapArray[i].y + mapArray[i].height > object.y
          ) {
            if (mapArray[i].type == "lava") { 
                typeDeath = "you been scorched by da-lava";
                  hp-=0.1;
            } else if (mapArray[i].type == "wall" || mapArray[i].type == "lock") {
                if(Math.abs(horizontal)>Math.abs(vertical)){  
                if (horizontal > 0) {
                    object.x-=movementSpeed;
                }
                  else if (horizontal < 0 ){
                    object.x+=movementSpeed;
                  } 
                } else {
                  if (vertical < 0) {
                    object.y+=movementSpeed;
                  }
                  else if(vertical > 0) {
                    object.y-=movementSpeed;
                }
            }
            } else if (mapArray[i].type == "water") {
            movementSpeed = 0.5;
        } else {
                movementSpeed = 3;
            } 
        if (mapArray[i].type == "jumppad" && object == player) {
              verticalPower = 7.5;
              grounded = false;
            } else if (mapArray[i].type == "exit" && object == player) {
              portalSound.play();
              reset();
              passes+=1;
            }
            }
        }
      }

      var spawn = 0;

      function spawnEnemy() {
        spawn+=1;
        if (spawn>10 && enemy.length<20) {
          enemy.push(
            new component(
              20,
              20,
              "purple",
              (Math.random())*990,
              10,
              "multiarray",
              1,
              1 
            )
          );
          spawn = 0;
        }
      }

      function enemyCollision() {
    
    for(e = 0; e < enemy.length ; e+=1) {

      if (
            enemy[e].x < player.x + player.width &&
            enemy[e].x + enemy[e].width > player.x &&
            enemy[e].y < player.y + player.height &&
            enemy[e].y + enemy[e].height > player.y
          ) {
            typeDeath = "you been mowed by da enemy"
            hp-=1;
            enemy.splice(e,1);
          }


        for (i = 0; i < mapArray.length; i += 1) {  
          var horizontal =
                mapArray[i].x +
                (mapArray[i].width / 2) -
                (enemy[e].x + enemy[e].width / 2);
        var vertical =
                mapArray[i].y +
                (mapArray[i].height / 2) -
                (enemy[e].y + enemy[e].height / 2);
          if (
            mapArray[i].x < enemy[e].x + enemy[e].width &&
            mapArray[i].x + mapArray[i].width > enemy[e].x &&
            mapArray[i].y < enemy[e].y + enemy[e].height &&
            mapArray[i].y + mapArray[i].height > enemy[e].y
          ) {
            if (mapArray[i].type == "lava") { 
                  enemy.splice(e, 1);
                  kills+=1;
                  money+=1;
            }
            if (mapArray[i].type == "wall" || mapArray[i].type == "lock") {
                if(Math.abs(horizontal)>Math.abs(vertical)){  
                    if (horizontal > 0) {
                    enemy[e].x-=enemy[e].xSpeed;
                }
                  else if (horizontal < 0 ){
                    enemy[e].x+=enemy[e].xSpeed;
                  } 
                } else {
                  if (vertical < 0) {
                    enemy[e].y+=enemy[e].ySpeed;
                  }
                  else if(vertical > 0) {
                    enemy[e].y-=enemy[e].ySpeed;
                }
            } 
        }
        if (mapArray[i].type == "water") {
            enemy[e].xSpeed = 0.25;
            enemy[e].ySpeed = 0.25;
        } else {
          enemy[e].xSpeed = 1;
            enemy[e].ySpeed = 1;
            } 
        
        }
       
        
            
        }
        }
        }

      function enemyMovement(){
        for(e = 0; e < enemy.length; e += 1){
            if(enemy[e].x<player.x){
                enemy[e].x +=enemy[e].xSpeed;
            } else if (enemy[e].x>player.x) {
                enemy[e].x -=enemy[e].xSpeed;
            }
            if(enemy[e].y<player.y){
                enemy[e].y +=enemy[e].ySpeed;
            } else if (enemy[e].y>player.y){
                enemy[e].y -=enemy[e].ySpeed;
            }

        }
      };

      function drawBackground() {
        mapArray = [];
        var mapIndex = 0;
        for (y = 0; y < 20; y++) {
          for (x = 0; x < 40; x++, mapIndex++) {
            var tile_x = x * 25;
            var tile_y = y * 25;

            var tileType = map[mapIndex];

            if (tileType == 1) {
              mapArray.push(
                new component(25, 25, "black", tile_x, tile_y, "wall")
              );
            } else if (tileType == 2) {
              mapArray.push(
                new component(25, 25, "blue", tile_x, tile_y, "water")
              );
            } else if (tileType == 3) {
              mapArray.push(
                new component(25, 25, "red", tile_x, tile_y, "lava")
              );
            } else if (tileType == 4) {
              mapArray.push(
                new component(25, 25, "brown", tile_x, tile_y, "bridge")
              );
            } else if (tileType == l) {
              mapArray.push(
                new component(25, 25, "gray", tile_x, tile_y, "lock")
              );
            } else if (tileType == k) {
              mapArray.push(
                new component(25, 25, "yellow", tile_x, tile_y, "key")
              );
            } else {
              mapArray.push(
                new component(25, 25, "lightgreen", tile_x, tile_y, "sky")
              );
            }
          }
        }
      }






      function reset(){
        scene = "survival";
        hp = 3;
        deathTimer = 0; 
        player.x = 0;
        player.y = 465;
        verticalPower = 0;
        enemy = [];
        bullets = [];
        deathScreen.width = 0;
        deathScreen.height = 0;
    }

      function death(){
        scene = "death";

        if(deathTimer < 1){
        vaporize.play();
        }
        //stop background sound
        deathTimer +=1;

        Game.context.textAlign = "center";
        deathText1.text = "YOU DIED!"
        deathText2.text = typeDeath;
        deathText3.text = "Hit R to Restart";
        deathScreen.width = 1200;
        deathScreen.height = 500;
        deathScreen.x = 0;
        deathScreen.y = 0;
        deathScreen.update();
        deathText1.update();
        deathText2.update();
        deathText3.update();
        if(Game.keys[82]){
            reset();
        }
    }

    function survival(){
    scene = "survival"; 

    drawBackground();
        for (i = 0; i < mapArray.length; i++) {
          mapArray[i].update();
        }   
        enemyMovement();
        enemyCollision();
        spawnEnemy();
        for (e = 0; e < enemy.length; e++){
            enemy[e].update();
        }
        for (t = 0; t < trees.length; t++){
            trees[t].update();
        }
        for (s = 0; s < stones.length; s++){
            stones[s].update();
        }
        player.update();
        fireBullets();
        updateBullets(bullets);
        for (i = 0; i < bullets.length; i++) {
          bullets[i].update();
        }
        mapCollision(player);
    }





      function updateGame() {
        Game.clear(); 
        Game.frameNo += 1;
          if(scene == "survival"){//sound plays
          }


        if(Game.keys[87]){
            player.y-=movementSpeed;
        }
        if(Game.keys[83]){
            player.y+=movementSpeed;
        }
        if(Game.keys[65]){
            player.x-=movementSpeed;
        }
        if(Game.keys[68]){
            player.x+=movementSpeed;
        }



        if (player.y < 0) {
          player.y = 0;
        
        }
        if (player.x > 990) {
          player.x = 990;
          
        }

        if (player.y > 490) {
          player.y = 490;
          
        }
        if (player.x < 0) {
          player.x = 0;
          
        }

        if(scene == "survival"){
          survival();
        }
        if(scene == "death"){
        death();
        }
        if(hp<=0){
          death();
        }
        
        updatePanel();
      }
    
    
    
    
    
    
    function updatePanel(){
        var hpdisplay = document.getElementById("hp");
        hpdisplay.innerText = "HP: " + Math.ceil(hp);
        var killsdisplay = document.getElementById("kills");
        killsdisplay.innerText = "Kills: " + kills;
        var hpdisplay = document.getElementById("stone");
        hpdisplay.innerText = "Stone: " + stoneAmount;
        var sidePanel = document.getElementById("side");
        sidePanel.style.marginTop = (window.innerHeight-500)/2 + "px";
        sidePanel.style.width = (window.innerWidth-1000)/2-10 + "px";
    }



    </script>

    <div id="side">
    <p>Stats: </p>
    <p id="hp"></p>
    <p id="kills"></p>
    <p id="stone"></p>
    <p id="wood"></p>
    </div>

  </body>
</html>
